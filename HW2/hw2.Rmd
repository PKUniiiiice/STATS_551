---
title: "STATS 551 HW2"
author: "Minxuan Chen"
date: "2023/10/2"
output:
  pdf_document:
    latex_engine: pdflatex
    fig_width: 6
    fig_height: 5
  html_document:
    fig_width: 6
    toc_depth: 4
  word_document:
    toc_depth: '4'
fontsize: 12pt
urlcolor: blue
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = TRUE,
	warning = TRUE
)
```

We contribute to each of the problem equally by finishing them individually and having a discussion to agree on the answers. And we improved our solution to Problem 3 together during the discussion.


## Problem 1

## Problem 2
### (a)
Prior
$$
\theta_A \sim \operatorname{gamma}(120,10), \theta_B \sim \operatorname{gamma}(12,1), p\left(\theta_A, \theta_B\right)=p\left(\theta_A\right) \times p\left(\theta_B\right)
$$
Likelihood
$$
\begin{aligned}
&y_A|\theta_A \sim \mathcal{P}(\theta_A), y_A \,\,\text{i.i.d.} \\
&y_B|\theta_B \sim \mathcal{P}(\theta_B), y_B \,\,\text{i.i.d.} \\
&y_A\perp\!\!\!\!\perp y_B
\end{aligned}
$$
Posterior
$$
\begin{aligned}
&\theta_A|\mathbf{y}_A, \mathbf{y}_B \sim  \operatorname{gamma}(120+10\bar{y}_A,10+10)=\operatorname{gamma}(237, 20) \\
&\theta_B|\mathbf{y}_A, \mathbf{y}_B \sim  \operatorname{gamma}(12+13\bar{y}_B,1+13)=\operatorname{gamma}(195, 14) \\
\end{aligned}
$$
```{r p2a}
ya <- c(12,9,12,14,13,13,15,8,15,6)
yb <- c(11,11,10,9,9,87,10,6,8,8,9,7)
sum(ya)
sum(yb)
```

Posterior mean
$$
E(\theta_A|\mathbf{y}_A, \mathbf{y}_B) = \frac{237}{20}=11.85, \quad E(\theta_B|\mathbf{y}_A, \mathbf{y}_B) = \frac{195}{14}=13.929
$$

Posterior variance
$$
Var(\theta_A|\mathbf{y}_A, \mathbf{y}_B) = \frac{237}{400},\quad
Var(\theta_B|\mathbf{y}_A, \mathbf{y}_B) = \frac{195}{196}
$$

Posterior confidence interval
```{r}
#theta_A
cat("theta_A: ", qgamma(c(.025, .975), 237, 20), "\n")

#theta_B
cat("theta_B: ", qgamma(c(.025, .975), 195, 14))
```

### (b)
Posterior
$$
\theta_B|\mathbf{y}_A, \mathbf{y}_B \sim  \operatorname{gamma}(12n_0+13\bar{y}_B,n_0+13)=\operatorname{gamma}(12n_0+185, 13+n_0) \\

$$
```{r}
#posterior expectation is (12n_0+185)/(13+n_0)
(12*1:50+185)/(13+1:50)
```

For arbitrary gamma prior, $\theta_B \sim \operatorname{gamma}(\alpha,\beta)$,
to make the posterior expectation of $\theta_B$ to be close to that of $\theta_A$, just make them equal and solve
$$
\frac{\alpha+185}{\beta+13}=\frac{237}{20}
$$
we get
$$
\beta = -30.95 + 7.9\alpha,\quad \alpha,\beta>0
$$
Therefore, if the parameter of $\theta_B$'s prior locate at the line $\beta=-30.95+7.9\alpha$, we can get exactly the same posterior expectation. To get a close result, you can add small perturbation to this line.

### (c)
No. Since the prior $p(\theta_A,\theta_B) = p(\theta_A)\times p(\theta_B)$ implies the independence between type A and type B. In other words
$$
p(\theta_{B}|\mathbf{y}_A, \mathbf{y}_B) = p(\theta_{B}|\mathbf{y}_B)
$$
We can prove it.     
*Proof*
$$
\begin{aligned}
p(\theta_{A},\theta_{B}|\mathbf{y}_A, \mathbf{y}_B) 
\propto p(\mathbf{y}_A, \mathbf{y}_B|\theta_{A},\theta_{B})p(\theta_{A},\theta_{B})
\end{aligned}
$$
Note that type A and type B are independent given $\theta_A,\theta_B$ (due to different type, i.e. two populations), so
$$
\begin{aligned}
p(\theta_{A},\theta_{B}|\mathbf{y}_A, \mathbf{y}_B) 
&\propto p(\mathbf{y}_A|\theta_{A},\theta_{B})p(\mathbf{y}_B|\theta_{A},\theta_{B}) p(\theta_{A})p(\theta_{B})\\
&\propto p(\mathbf{y}_A|\theta_{A})p(\theta_A)\cdot p(\mathbf{y}_B|\theta_{B})p(\theta_B)\\
&\propto p(\theta_A|\mathbf{y}_A) p(\theta_B|\mathbf{y}_B)
\end{aligned}
$$
The second line is because in the sampling model we assume type A or B is only influenced by its own parameter.     
We integrate over $\theta_A$
$$
p(\theta_{B}|\mathbf{y}_A, \mathbf{y}_B) =C\cdot p(\theta_B|\mathbf{y}_B)
$$
Note that both sides are pdf of $\theta_B$, so if we integrate over $\theta_B$ again, we must have $C=1$, i.e. 
$$
p(\theta_{B}|\mathbf{y}_A, \mathbf{y}_B) = p(\theta_B|\mathbf{y}_B)
$$

It doesn't make sense to have $p(\theta_A, \theta_B) = p(\theta_A)p(\theta_B) $ because it's known that type B mice are related to type A mice. The previous prior implies there's no connection between type A and B.

### (d)



























